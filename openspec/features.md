# 功能详细说明书 (Functional Specification)

## 1. 浏览与筛选 (Browse & Filter)

### 1.1 搜索
*   **入口**: 顶部吸顶工具栏左侧。
*   **逻辑**: 实时模糊匹配。搜索范围包括 `name` (机型名称) 和 `chip` (芯片名称)。不区分大小写。
*   **反馈**: 输入即触发列表更新。

### 1.2 筛选器 (Filters)
*   **设备类型 (Segmented Control)**:
    *   选项: 全部 / 笔记本 (Laptops) / 台式机 (Desktops) / 平板 (iPad)。
    *   逻辑: 单选，点击切换，列表即时过滤。
*   **芯片家族 (Dropdown)**:
    *   选项: All Chips, M4 Family, M3 Family, M2 Family, M1 Family, Intel Series。
    *   逻辑: 筛选特定代的芯片。
*   **排序 (Toggle)**:
    *   选项循环: 分数 (默认, 高到低) -> 价格 (高到低) -> 年份 (新到旧)。
*   **评分场景 (Scenario)**:
    *   选项: Balanced (默认), Developer, Creative, Daily。
    *   逻辑: 切换不同权重的综合评分算法。
*   **PC 参照系 (PC/GPU Ref)**:
    *   开关: 筛选控制栏右侧的 Toggle 按钮。
    *   逻辑: 开启后混入 PC 顶级硬件数据 (如 RTX 4090, i9-14900K) 作为性能锚点。
    *   视觉区分: 参照硬件在图表中使用斜线填充图案。

### 1.3 分享功能
*   **入口**: 筛选控制栏的分享图标按钮。
*   **逻辑**: 
    *   优先使用 Web Share API 调用原生分享对话框。
    *   降级到剪贴板复制链接，显示 Toast 提示。
*   **链接内容**: 包含当前所有筛选、排序、场景、参照系状态的 URL 参数。

## 2. 性能排行榜表格 (Leaderboard Table)

### 2.1 列表展示
*   **列定义**:
    *   **#**: 序号。
    *   **Rank**: 段位徽章 (S+, S, A+, A, B, C, D)。
    *   **Model & Chip**: 机型名称与芯片型号，副标题显示年份。**(Sticky: 移动端固定在左侧)**
    *   **CPU/GPU Cores**: (移动端隐藏) 显示核心配置。
    *   **Performance**: 综合评分 (Composite Score)。
    *   **Price**: (移动端隐藏) 发售价。
    *   **Action**: 对比勾选框。
*   **响应式行为**: 在小屏幕设备上，机型名称列固定在左侧，用户可以横向滑动查看右侧的评分数据，始终保持机型名称可见。

### 2.2 详情查看
*   **交互**: 点击表格行任意位置（除勾选框外）。
*   **反馈**: 弹出 `DetailModal`。

## 3. 机型对比 (Comparison)

### 3.1 选择机制
*   **操作**: 点击表格左侧的方形按钮。
*   **限制**: 最多选择 **2** 款机型。
*   **状态反馈**:
    *   选中项背景变蓝。
    *   当选中 2 项时，其余未选项的勾选框变灰 (Disabled)。
    *   底部出现悬浮操作栏 (Floating Action Bar)，显示当前选中数量和缩略芯片名。
*   **URL 同步**: 选中的机型 ID 通过 `compare` 参数同步到 URL。

### 3.2 对比视图
*   **入口**: 点击悬浮栏的 "Compare" 按钮。
*   **内容**:
    *   **头部**: 并列展示两款机型的段位、名称、年份、价格。中间显示 "VS"。
    *   **雷达图 (Radar Chart)**: 位于顶部的可视化中心，展示 **Single-Core**, **Multi-Core**, **Metal**, **Pts/$** (性价比), **Memory** (最大内存) 五个维度的相对强弱。
    *   **详细对比条**:
        *   针对综合分、单核、多核、Metal分四个维度。
        *   使用条形图展示相对强弱。
        *   **Winner Logic**: 分数高者的条形图为蓝色/高亮，低者为灰色。
        *   **Diff Label**: 自动计算胜出者比落后者强多少百分比 (例如 "MacBook Pro +25%")。
    *   **参数列表**: 底部网格展示内存范围、GPU核心数等具体规格。

## 4. 图表分析 (Charts)

### 4.1 综合图表
*   **默认视图**: 垂直条形图，展示当前筛选结果中 Top 15 的机型。
*   **颜色编码**: 条形颜色与段位徽章颜色一致 (S+紫色, A蓝色等)，便于视觉关联。
*   **参照系样式**: 开启 PC/GPU Ref 时，参照硬件使用斜线填充图案。

### 4.2 模式切换
*   用户可点击图表上方的胶囊按钮切换维度：
    *   **Composite**: 综合加权分。
    *   **Single-Core**: 纯 CPU 单核性能。
    *   **Multi-Core**: 纯 CPU 多核性能。
    *   **Metal GPU**: 纯图形性能。
    *   **Value (Scatter)**: 散点图模式。
    *   **Points/$**: 性价比排行（每美元换算的性能分）。

### 4.3 散点图交互
*   **X轴**: 价格 (USD)。
*   **Y轴**: 综合评分。
*   **象限**: 显示平均价格和平均分数的参考线。
*   **Tooltip**: 悬停显示机型详情及具体的 "Pts/$" 数值。

## 5. AI 顾问 (AI Chat)

### 5.1 入口
*   右下角悬浮 "Sparkles" 按钮。点击展开聊天窗口。

### 5.2 对话逻辑
*   **初始化**: 打开即显示欢迎语 (支持多语言)。
*   **发送**: 用户输入问题 -> 调用 `getMacAdvice` -> 显示 Loading 动画 -> 显示 AI 回复。
*   **知识库**: AI 拥有当前 Top 40 机型的详细数据（名称、跑分、价格）。
*   **输出格式**: 支持 Markdown (加粗、列表) 和 HTML 换行渲染。
*   **延迟优化**: 设置 `thinkingBudget: 0` 关闭思维链以提高响应速度。

### 5.3 离线降级 (Offline Mode)
*   **触发条件**: 检测到 `navigator.onLine` 为 false 或 API 调用失败。
*   **逻辑**: 
    *   本地关键词匹配相关机型。
    *   按年份和多核评分排序。
    *   返回 Top 3 匹配结果。
*   **输出**: 简单格式化的文本建议，包含机型规格和简短分析。

## 6. 详情模态框 (Detail Modal)
*   **头部**: 大号机型名称、段位徽章、关闭按钮。
*   **描述**: AI 生成的简短评价 (存储在 `description` 字段)。
*   **核心规格**: CPU/GPU/内存的三列布局。
*   **性能仪表盘**: 三个进度条分别展示 Single/Multi/Metal 分数在满分(预设最大值)中的占比。
*   **底部**: 发售价展示及"规格已验证"标识。

## 7. 设置与主题 (Settings)

### 7.1 入口
*   顶部导航栏的"设置"按钮。

### 7.2 功能
*   **语言选择**: 下拉菜单选择 10 种语言之一。
    *   存储位置: `localStorage.language`。
    *   SEO: 切换时动态更新页面标题。
*   **主题切换**: 深色/浅色模式切换。
    *   存储位置: `localStorage.theme`。
    *   初始化: 首次加载时检测系统偏好 `prefers-color-scheme: dark`。
    *   实现: 通过 `document.documentElement.classList.toggle('dark')`。
*   **重置数据**: 清除本地存储的语言和主题设置。
*   **源代码**: 链接到 GitHub 仓库。

## 8. 系统特性 (System Features)

### 8.1 URL 状态同步
*   **支持参数**: `search`, `type`, `family`, `sort`, `scenario`, `ref`, `compare`。
*   **初始化**: 页面加载时解析 URL 参数恢复状态。
*   **更新**: 状态变化时使用 `history.replaceState` 更新 URL（无刷新）。
*   **分享**: 链接可直接分享，打开时恢复完整筛选状态。

### 8.2 PWA (Progressive Web App)
*   **安装**: 支持添加到主屏幕 (Mobile) 或安装为桌面应用 (Desktop)。
*   **离线访问**: 
    *   核心应用 Shell (HTML/CSS/JS) 自动缓存。
    *   静态资源缓存策略为 CacheFirst。
    *   断网状态下仍可浏览已加载的排行榜数据。
*   **Web App Manifest**: 配置了名称、图标、主题色，支持 Standalone 显示模式。

### 8.3 返回顶部 (Back to Top)
*   **触发条件**: 滚动超过 500px 时显示。
*   **位置**: 左下角固定按钮。
*   **交互**: 点击后平滑滚动到顶部。

### 8.4 深色模式
*   **切换**: 设置中的开关按钮或系统检测。
*   **存储**: localStorage + class 切换。
*   **适配**: 所有 UI 组件都支持 `dark:` 修饰符。
